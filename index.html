<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/128/9856/9856743.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é«˜ä¸­ç‡ŸéšŠè³‡è¨Šå…¬å‘Šæ¿</title>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
       body { font-family: "Microsoft JhengHei", Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        
        /* --- æ¨™é¡Œå€ --- */
        header { text-align: center; margin-bottom: 20px; }
        h1 { color: #1a73e8; margin-bottom: 5px; }
        .subtitle { color: #666; font-size: 0.9em; }

        /* --- æœå°‹æ¬„æ¨£å¼ (æ–°å¢) --- */
        .search-container { margin-bottom: 20px; text-align: center; }
        #searchInput {
            width: 100%; max-width: 500px; padding: 12px 20px;
            border: 2px solid #ddd; border-radius: 25px;
            font-size: 16px; outline: none; transition: all 0.3s;
        }
        #searchInput:focus { border-color: #1a73e8; box-shadow: 0 0 8px rgba(26,115,232,0.2); }

        /* --- åˆ—è¡¨èˆ‡å¡ç‰‡ --- */
        /* ä¿®æ”¹ .card çš„æ¨£å¼ */
    .camp-list { 
    display: grid; 
    gap: 25px; /* â˜… ä¿®æ”¹ 1: é–“è·å¾ 15px æ”¹ç‚º 25pxï¼Œå¡ç‰‡åˆ†æ›´é–‹ */
    min-height: 200px; 
}

/* --- å¡ç‰‡æ¨£å¼èª¿æ•´ --- */
.card { 
    background: white; 
    padding: 25px; /* â˜… ä¿®æ”¹ 2: å…§è·å¾ 20px æ”¹ç‚º 25pxï¼Œå…§éƒ¨æ›´å¯¬æ• */
    border-radius: 16px; /* åœ“è§’ç¨å¾®å¤§ä¸€é»ï¼Œçœ‹èµ·ä¾†æ›´æŸ”å’Œ */
    box-shadow: 0 4px 12px rgba(0,0,0,0.08); /* é™°å½±ç¨å¾®åŠ æ·±ï¼Œå¢åŠ ç«‹é«”æ„Ÿ */
    cursor: pointer; 
    transition: all 0.3s ease;
    border-left: 6px solid #1a73e8; /* å·¦é‚Šç·šæ¢åŠ ç²—ä¸€é» */
    
    /* å‹•ç•«è¨­å®š (ä¿ç•™æ‚¨åŸæœ¬çš„) */
    opacity: 0;
    animation: fadeInUp 0.5s ease forwards;
}

.card:hover { 
    transform: translateY(-5px); /* æµ®èµ·çš„é«˜åº¦å¢åŠ  */
    box-shadow: 0 8px 25px rgba(0,0,0,0.15); 
}

/* --- å¡ç‰‡å…§éƒ¨æ–‡å­—é–“è·èª¿æ•´ --- */
.card-date { 
    color: #e91e63; 
    font-weight: bold; 
    font-size: 0.9em; 
    margin-bottom: 12px; /* â˜… ä¿®æ”¹ 3: æ—¥æœŸè·Ÿæ¨™é¡Œæ‹‰é–‹è·é›¢ */
    letter-spacing: 0.5px; /* å­—å…ƒé–“è·å¾®èª¿ */
}

.card-title { 
    font-size: 1.3em; /* å­—é«”ç¨å¾®åŠ å¤§ */
    font-weight: bold; 
    color: #333; 
    line-height: 1.4; /* â˜… ä¿®æ”¹ 4: æ¨™é¡Œè¡Œé«˜å¢åŠ ï¼Œé¿å…å…©è¡Œå­—è²¼åœ¨ä¸€èµ· */
    margin-bottom: 12px; /* æ¨™é¡Œè·Ÿé è¦½æ–‡å­—æ‹‰é–‹è·é›¢ */
}

.card-preview { 
    color: #666; 
    font-size: 0.95em; 
    margin-top: 10px; 
    line-height: 1.6; /* é è¦½æ–‡å­—è¡Œé«˜å¢åŠ  */
    
    /* è®“é è¦½æ–‡å­—é¡¯ç¤ºå…©è¡Œå†æˆªæ–· (æ¯”å–®è¡Œæ›´å¥½çœ‹) */
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal; /* å…è¨±æ›è¡Œ */
}

    /* â˜…â˜…â˜… æ–°å¢é€™å€‹å‹•ç•«å®šç¾© (æ”¾åœ¨ .card ä¸‹é¢å³å¯) â˜…â˜…â˜… */
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(30px); /* å¾ä¸‹æ–¹ 30px è™•é–‹å§‹ */
        }
        to {
            opacity: 1;
            transform: translateY(0); /* å›åˆ°åŸä½ */
        }
    }

        /* --- åˆ†é æ§åˆ¶å™¨æ¨£å¼ (æ–°å¢) --- */
        .pagination { display: flex; justify-content: center; gap: 8px; margin-top: 30px; flex-wrap: wrap; }
        .page-btn {
            background: white; border: 1px solid #ddd; color: #333;
            padding: 8px 14px; border-radius: 6px; cursor: pointer; transition: 0.2s;
        }
        .page-btn:hover { background: #f1f1f1; }
        .page-btn.active { background: #1a73e8; color: white; border-color: #1a73e8; }
        .page-btn:disabled { opacity: 0.5; cursor: not-allowed; }

        /* --- å½ˆå‡ºè¦–çª— (Modal) --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 1000;
            justify-content: center; align-items: center;
        }
        .modal {
            background: white; width: 90%; max-width: 700px; max-height: 90vh;
            border-radius: 15px; padding: 25px; overflow-y: auto;
            position: relative; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        .modal-close { position: absolute; top: 15px; right: 20px; font-size: 24px; cursor: pointer; color: #999; }
        .modal-title { font-size: 1.5em; color: #333; margin-bottom: 10px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        .modal-meta { color: #888; font-size: 0.9em; margin-bottom: 20px; }
        .modal-content { line-height: 1.8; color: #444; white-space: pre-wrap; font-size: 1em; }
        
        .attach-section { margin-top: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px; }
        .attach-title { font-weight: bold; color: #555; margin-bottom: 10px; display: block; }
        .attach-link { 
            display: inline-block; background: #fff; border: 1px solid #ddd; 
            padding: 8px 12px; border-radius: 20px; text-decoration: none; 
            color: #1a73e8; font-size: 0.9em; margin-right: 10px; margin-bottom: 10px;
        }
        .attach-link:hover { background: #e8f0fe; }

        .loading { text-align: center; color: #666; padding: 50px; }
        .no-result { text-align: center; color: #888; padding: 30px; display: none; }
        .original-link-btn {
            display: block; width: 100%; text-align: center; margin-top: 20px;
            background: #1a73e8; color: white; text-decoration: none; padding: 12px;
            border-radius: 8px; font-weight: bold;
        }
    @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
    }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸ“ æœ€æ–°é«˜ä¸­ç‡ŸéšŠè³‡è¨Š</h1>
        <div class="subtitle">å³æ™‚åŒæ­¥å„å¤§å°ˆé™¢æ ¡ç‡ŸéšŠæƒ…å ±</div>
    </header>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="ğŸ” æœå°‹ç‡ŸéšŠåç¨±æˆ–å…§å®¹..." onkeyup="filterData()">
    </div>

    <div id="loading" class="loading">æ­£åœ¨è¼‰å…¥è³‡æ–™ï¼Œè«‹ç¨å€™...</div>
    
    <div id="noResult" class="no-result">æ²’æœ‰æ‰¾åˆ°ç¬¦åˆçš„ç‡ŸéšŠè³‡æ–™ã€‚</div>

    <div id="campList" class="camp-list"></div>

    <div id="pagination" class="pagination"></div>
</div>

<div id="modalOverlay" class="modal-overlay" onclick="closeModal(event)">
    <div class="modal">
        <span class="modal-close" onclick="closeModalBtn()">Ã—</span>
        <div id="modalDate" class="modal-meta" style="color:#e91e63; font-weight:bold;"></div>
        <div id="modalTitle" class="modal-title"></div>
        <div id="modalContent" class="modal-content"></div>
        
        <div id="attachSection" class="attach-section" style="display:none;">
            <span class="attach-title">ğŸ“ ç›¸é—œé™„ä»¶ä¸‹è¼‰ï¼š</span>
            <div id="modalAttachments"></div>
        </div>

        <a id="modalLink" href="#" target="_blank" class="original-link-btn">å‰å¾€åŸå§‹å…¬å‘Šé é¢</a>
    </div>
</div>

<script>
    // â˜…â˜…â˜… è«‹å°‡é€™è£¡æ›æˆæ‚¨çš„ Apps Script ç¶²é æ‡‰ç”¨ç¨‹å¼ç¶²å€ â˜…â˜…â˜…
    const API_URL = "https://script.google.com/macros/s/AKfycbxNOG_cxSIFr7RKC5mlb8wGpKBmUrTPMFv4QqNy0hxWj9X5deMX3V7NBt7mwoI_5V0S/exec"; 

    // å…¨åŸŸè®Šæ•¸
    let allCamps = [];       // å­˜æ”¾æ‰€æœ‰è³‡æ–™
    let filteredCamps = [];  // å­˜æ”¾æœå°‹å¾Œçš„è³‡æ–™
    let currentPage = 1;     // ç›®å‰é ç¢¼
    const itemsPerPage = 15; // â˜… è¨­å®šæ¯é é¡¯ç¤º 15 ç­†

    // åˆå§‹åŒ–ï¼šè¼‰å…¥è³‡æ–™
    fetch(API_URL)
        .then(response => response.json())
        .then(data => {
            document.getElementById('loading').style.display = 'none';
            // å°‡è³‡æ–™åè½‰ï¼Œè®“æœ€æ–°çš„æ—¥æœŸæ’åœ¨æœ€ä¸Šé¢
            allCamps = data.reverse();
            filteredCamps = allCamps; // é è¨­é¡¯ç¤ºå…¨éƒ¨
            
            renderPage(1); // é¡¯ç¤ºç¬¬ä¸€é 
        })
        .catch(error => {
            document.getElementById('loading').innerHTML = 'âŒ è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª API ç¶²å€è¨­å®šæ­£ç¢ºã€‚';
            console.error(error);
        });

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæœå°‹éæ¿¾ ---
    function filterData() {
        const keyword = document.getElementById('searchInput').value.toLowerCase();
        
        filteredCamps = allCamps.filter(camp => {
            const titleMatch = camp.title.toLowerCase().includes(keyword);
            const contentMatch = camp.content && camp.content.toLowerCase().includes(keyword);
            return titleMatch || contentMatch;
        });

        // æœå°‹å¾Œé‡ç½®å›ç¬¬ä¸€é 
        renderPage(1);
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šæ¸²æŸ“é é¢ (å«åˆ†é é‚è¼¯) ---
    function renderPage(page) {
        currentPage = page;
        const listContainer = document.getElementById('campList');
        const noResult = document.getElementById('noResult');
        listContainer.innerHTML = ''; // æ¸…ç©ºåˆ—è¡¨

        // æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™
        if (filteredCamps.length === 0) {
            noResult.style.display = 'block';
            document.getElementById('pagination').innerHTML = ''; // éš±è—åˆ†é 
            return;
        } else {
            noResult.style.display = 'none';
        }

        // è¨ˆç®—åˆ†é åˆ‡ç‰‡
        const startIndex = (page - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const pageItems = filteredCamps.slice(startIndex, endIndex);

        // ç”Ÿæˆå¡ç‰‡
        // ä¿®æ”¹ pageItems.forEach çš„éƒ¨åˆ†
    pageItems.forEach((camp, index) => { // æ³¨æ„é€™è£¡å¤šäº†ä¸€å€‹ index åƒæ•¸
        let dateStr = camp.date ? String(camp.date).substring(0, 10) : 'æœªæ¨™ç¤º';
        if (dateStr.includes('T')) dateStr = dateStr.split('T')[0];

        const card = document.createElement('div');
        card.className = 'card';
    
        // â˜…â˜…â˜… åŠ å…¥é€™è¡Œï¼šè¨­å®šå‹•ç•«å»¶é² â˜…â˜…â˜…
        // é‚è¼¯ï¼šç¬¬1å¼µå»¶é²0ç§’ï¼Œç¬¬2å¼µå»¶é²0.1ç§’ï¼Œç¬¬3å¼µ0.2ç§’...ä»¥æ­¤é¡æ¨
        card.style.animationDelay = `${index * 0.1}s`; 

        card.innerHTML = `
            <div class="card-date">ğŸ“… ${dateStr}</div>
            <div class="card-title">${camp.title}</div>
            <div class="card-preview">é»æ“ŠæŸ¥çœ‹è©³ç´°è³‡è¨Š...</div>
            `;
        card.onclick = () => openModal(camp);
        listContainer.appendChild(card);
    });

        // æ¸²æŸ“åˆ†é æŒ‰éˆ•
        renderPagination();
        
        // é é¢æ»¾å‹•åˆ°é ‚éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- æ ¸å¿ƒåŠŸèƒ½ï¼šç”Ÿæˆåˆ†é æŒ‰éˆ• ---
    function renderPagination() {
        const paginationContainer = document.getElementById('pagination');
        paginationContainer.innerHTML = '';
        const totalPages = Math.ceil(filteredCamps.length / itemsPerPage);

        if (totalPages <= 1) return; // åªæœ‰ä¸€é å°±ä¸é¡¯ç¤ºåˆ†é å™¨

        // ä¸Šä¸€é æŒ‰éˆ•
        const prevBtn = document.createElement('button');
        prevBtn.innerText = 'Â« ä¸Šä¸€é ';
        prevBtn.className = 'page-btn';
        prevBtn.disabled = currentPage === 1;
        prevBtn.onclick = () => renderPage(currentPage - 1);
        paginationContainer.appendChild(prevBtn);

        // é ç¢¼æŒ‰éˆ• (æœ€å¤šé¡¯ç¤º 5 å€‹é ç¢¼ï¼Œé¿å…å¤ªé•·)
        let startPage = Math.max(1, currentPage - 2);
        let endPage = Math.min(totalPages, startPage + 4);
        
        if (endPage - startPage < 4) {
            startPage = Math.max(1, endPage - 4);
        }

        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement('button');
            btn.innerText = i;
            btn.className = `page-btn ${i === currentPage ? 'active' : ''}`;
            btn.onclick = () => renderPage(i);
            paginationContainer.appendChild(btn);
        }

        // ä¸‹ä¸€é æŒ‰éˆ•
        const nextBtn = document.createElement('button');
        nextBtn.innerText = 'ä¸‹ä¸€é  Â»';
        nextBtn.className = 'page-btn';
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.onclick = () => renderPage(currentPage + 1);
        paginationContainer.appendChild(nextBtn);
    }

    // --- å½ˆå‡ºè¦–çª—åŠŸèƒ½ (ç¶­æŒä¸è®Š) ---
    function openModal(camp) {
        let dateStr = camp.date ? String(camp.date).substring(0, 10) : '';
        if (dateStr.includes('T')) dateStr = dateStr.split('T')[0];

        document.getElementById('modalDate').innerText = "ç™¼ä½ˆæ—¥æœŸï¼š" + dateStr;
        document.getElementById('modalTitle').innerText = camp.title;
        document.getElementById('modalContent').innerText = camp.content || "ç„¡è©³ç´°å…§å®¹";
        document.getElementById('modalLink').href = camp.link;

        const attachContainer = document.getElementById('modalAttachments');
        const attachSection = document.getElementById('attachSection');
        attachContainer.innerHTML = '';
        
        if (camp.attachments && camp.attachments.trim() !== "" && camp.attachments !== "ç„¡é™„ä»¶") {
            attachSection.style.display = 'block';
            let files = camp.attachments.split('\n');
            files.forEach((fileUrl, index) => {
                let fileName = "é™„ä»¶æª”æ¡ˆ " + (index + 1);
                try { fileName = decodeURIComponent(fileUrl.split('/').pop().split('?')[0]); } catch(e){}
                
                let a = document.createElement('a');
                a.href = fileUrl;
                a.target = "_blank";
                a.className = "attach-link";
                a.innerText = "ğŸ“„ " + fileName;
                attachContainer.appendChild(a);
            });
        } else {
            attachSection.style.display = 'none';
        }
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    function closeModal(event) {
        if (event.target.id === 'modalOverlay') document.getElementById('modalOverlay').style.display = 'none';
    }
    
    function closeModalBtn() {
        document.getElementById('modalOverlay').style.display = 'none';
    }
</script>

</body>
</html>
